00010 ' ====================================
00020 ' SPACE INVADERS COM TILES  
00030 ' MANOEL NETO 2025
00040 ' ====================================
00050 COLOR 15,1,1
00060 KEY OFF:CLS:DEFINT A-Z
00070 DIM EX(4,3),EY(4,3) : 'MATRIZ DE ALIENS
00080 CR=31: ' COLUNAS EM UMA LINHA 
00090 X=127:Y=174:V=16:'HEROI
00100 TX=0:TY=0:TV=16:TC=0 :'TORPEDO
00110 TIME=0:AN=1::VX=1:VY=20

00120 ' ************************************
00130 ' SPLASH SCREEN
00140 ' ************************************
00150 SCREEN 0
00160 LOCATE 14,10:? "SPACE INVADERS"
00170 LOCATE 10,12:? "PRESS FIRE TO START"
00180 LOCATE 12,14:? "MANOEL NETO 2024"
00190 OP$=INPUT$(1)

00200 ' ************************************
00210 ' INICIALIZA JOGO
00220 ' ************************************
00230 SCREEN 2,2,0
00240 RESTORE 9000
00250 GOSUB 5000 : ' TABELA DE SPRITES
00260 GOSUB 6000 : ' TABELA DE PADROES
00270 GOSUB 7000 : ' TABELA DE CORES  
00290 ON SPRITE GOSUB 3000 :' COLISOES
00300 ON STRIG GOSUB 2000  :' TIRO
00310 STRIG(0) ON
00320 FOR I = 0 TO 4
00330    FOR J = 0 TO 3
00340        EX(I,J)=16+J*20
00350        EY(I,J)=16+I*20
00360   NEXT J
00370 NEXT I

00400 ' ************************************
00410 ' ATUALIZA AS COORDENADAS       
00420 ' ************************************
00425 IF TC = 1 THEN GOSUB 1000:'TORPEDO
00430 FOR I = 0 TO 4
00440    FOR J = 0 TO 3
00450        EX(I,J)=EX(I,J)+VX
00460    NEXT J
00470 NEXT I
00480 IF EX(0,3)>=223 THEN 510 
00490 IF EX(0,0)<=16  THEN 510
00500 GOTO 600 : 'DESENHA O FRAME 
00510 ' INVERTE A DIRECAO DOS ALIENS
00520 VX=VX*-1
00530 FOR I = 0 TO 4
00540    FOR J = 0 TO 3
00550        EY(I,J)=EY(I,J)+VY
00560    NEXT J
00570 NEXT I

00600 ' ************************************
00610 ' DESENHA O FRAME               
00620 ' ************************************
00630 SPRITE OFF
00640   PUT SPRITE 0,(X,Y),6,0 : 'CANHAO
00650   IF TC=1 THEN PUT SPRITE 21,(TX,TY),8,3 : 'TORPEDO
00660   FOR I = 0 TO 4 : 'ALIENS
00670     FOR J = 0 TO 3
00680       CL = EX(I,J): ' COLUNA DO SPRITE ATUAL
00690       LI = EY(I,J): ' LINHA DO SPRITE ATUAL
00700       GOSUB 1500  : ' CALCULA ENDERECO NA VRAM
00710       FOR P = 0 TO 7
00720           VPOKE EN+P,AN+P
00730       NEXT P
00740     NEXT J
00750   NEXT I
00760 SPRITE ON
00770 IF TIME<2 GOTO 740
00780 IF AN=0 THEN AN=1 ELSE AN=0
00790 TIME=0 

00800 ' ************************************
00810 ' ENTRADA DO JOGADOR            
00820 ' ************************************
00830 S=STICK(0) 
00840 IF S = 3 THEN GOTO 870
00850 IF S = 7 THEN GOTO 880
00860 GOTO 920
00870 X=X+V:GOTO 920
00880 X=X-V:GOTO 920
00890 ' ************************************
00900 ' DETERMINA OS LIMITES DA TELA  
00910 ' ************************************
00920 IF X<0 THEN X=0
00930 IF X>239 THEN X=239
00940 GOTO 400

01000 ' ************************************
01010 ' MOVE O TORPEDO                 
01020 ' ************************************
01030 TY = TY - TV
01040 IF TY <= 0 THEN TY = -20:TC=0
01050 RETURN

01500 ' ************************************
01510 ' CALCULA ENDERECO DA POS NA VRAM     
01520 ' ************************************
01530 EN=6144+CL+LI*CR
01535 'PSET(100,100)
01536 'OPEN "GRP:" FOR OUTPUT AS #1
01537 'PRINT #1,EN
01540 RETURN

02000 ' ************************************
02010 ' ADICIONA UM TORPEDO           
02020 ' ************************************
02030 IF TC = 1 THEN RETURN
02040 TC=1:TX=X:TY=Y-10
02050 RETURN

03000 ' ************************************
03010 ' TRATA AS COLISOES             
03020 ' ************************************
03030 SPRITE OFF
03040 COLOR 15,1,1
03050 SCREEN 0
03060 CLS
03070 GOTO 4000
03080 END

04000 ' ************************************
04010 ' FIM DO JOGO 
04020 ' ************************************
04030 PRINT "DESEJA JOGAR NOVAMENTE? (S/N)"
04040 OP$=INPUT$(1)
04050 IF OP$="S" OR OP$="s" THEN 200
04060 END

05000 ' ************************************
05010 ' CARREGA A TABELA DE SPRITES          
05020 ' ************************************
05030 S=BASE(9)
05040 READ R$
05050 IF R$="*" THEN RETURN 
05060 VPOKE S,VAL("&H"+R$)
05070 S=S+1
05060 GOTO 5040

06000 ' ************************************
06010 ' CARREGA A TABELA DE PADROES 
06020 ' ************************************
06030 S=BASE(12)
06040 READ R$
06050 IF R$="*" THEN RETURN 
06060 R=VAL("&H"+R$)
06070 VPOKE S,R
06080 VPOKE 2048+S,R
06090 VPOKE 4096+S,R
06100 S=S+1
06110 GOTO 6040

07000 ' ************************************
07010 ' CARREGA A TABELA DE CORES  
07020 ' ************************************
07030 READ R$
07040 IF R$="*" THEN RETURN 
07050 R=VAL("&H"+R$)
07060 VPOKE 8192,R
07070 VPOKE 10240,R
07080 VPOKE 12288,R
07090 S=S+1
07100 GOTO 7030

09000 ' ************************************
09010 ' PADROES            
09020 ' ************************************
09030 ' CANHAO
09040 DATA 00,00,00,00,00,00,01,01
09050 DATA 07,07,07,7F,FF,FF,FF,FF
09060 DATA 00,00,00,00,00,00,80,80
09070 DATA E0,E0,E0,FE,FF,FF,FF,FF
09080 ' TORPEDO
09090 DATA 00,00,00,00,00,00,00,00
09100 DATA 00,01,01,01,01,01,01,01
09110 DATA 00,00,00,00,00,00,00,00
09120 DATA 00,80,80,80,80,80,80,80
09130 DATA *
09140 ' ALIEN 
01000 DATA 00,00,00,00,00,00,00,00
01010 DATA 18,3C,7E,DB,FF,24,5A,A5
01020 DATA 18,3C,7E,DB,FF,24,5A,A5
01030 DATA 18,3C,7E,DB,FF,5A,81,42
09240 DATA *
09250 ' TABELA DE CORES
09260 DATA 31,31,31,31,31,31,31,31
09270 DATA 31,31,31,31,31,31,31,31
09280 DATA 31,31,31,31,31,31,31,31
09290 DATA 31,31,31,31,31,31,31,31
09300 DATA *